---
title: "Ektron and Web Application Projects (Part 3)"
date: 2010-03-27
lastmod: 2010-03-29
draft: false
comments: true
thumbnail: "/coding-gallery"
series: ["ektron"]
authors: ["martincjarvis"]
---
<p>In this series of posts I’ve described a method of keeping your code and the required Ektron workarea separated.&nbsp; This method essentially turns the ‘drop-in compiled workarea’ feature request on it’s head, by dropping your compiled code into the work area.&nbsp; It’s the same result, just a slightly difference process (that you can do right now!):</p>  <ul>   <li>In <a href="http://bit.ly/a2O6y2">Part 1</a>, I discussed why you might want to develop your website outside of the default <a href="http://bit.ly/d0YHh7">Ektron</a> workarea and gave a brief overview of your options. </li>    <li>In <a title="Configuring the VS Solution and IIS" href="http://bit.ly/cntsnJ" target="_blank">Part 2</a>, I described how to organise the VS solution and configure IIS for use with Ektron workarea. </li> </ul>  <p>In this final part, I’ll describe how to combine your code with the Ektron workarea for final deployment.</p>  <h4>Leveraging the Post-Build Event</h4>  <p>The key to the whole process is the Post-Build Event in the <strong><em>clientproject</em>.Website</strong> Web Application (see <a title="Configuring the VS Solution and IIS" href="http://bit.ly/cntsnJ" target="_blank">Part 2</a>).&nbsp; We can use this to copy your compiled code into the workarea website using a set of <em><strong>xcopy</strong></em> (or similar)commands.&nbsp; To edit the Post-Build event right click on the clientproject.Website project and click ‘View Properties’ it will be on the ‘Build Events’ tab.&nbsp; There’s a handy editor that let’s you know the values of various ‘macros’ for your project.&nbsp; These macros are resolved automatically before the commands are executed and mean you don’t have to hard code absolute locations into your project.</p>  <p><a href="http://lh5.ggpht.com/_Vz_CYzsjR7M/S7ErjjddtnI/AAAAAAAAAB0/ecyYqUzvXJw/s1600-h/image%5B3%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Post-Build Event Editor in VS2008" border="0" alt="Post-Build Event Editor in VS2008" src="images/image_thumb[1].png" width="244" height="183" class="img-responsive"></a> </p>  <p>These should include any css or js that your templates need, an example entry into the Post-Build Event could be:</p>  <div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">   <div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet">     <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum1">   1:</span> <span style="color: #006080">"$(SolutionDir)3rd Party\Tools\CodebehindRemover\CodebehindRemover"</span> /i=<span style="color: #006080">"$(ProjectDir)."</span> /o=<span style="color: #006080">"$(SolutionDir)web\."</span> /e=<span style="color: #006080">"ascx,aspx,master,asmx,ascx,svc,htm,html"</span> </pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum2">   2:</span> xcopy <span style="color: #006080">"$(ProjectDir)js"</span> <span style="color: #006080">"$(SolutionDir)Web\js"</span> /E /I /R /D /C /Y</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum3">   3:</span> xcopy <span style="color: #006080">"$(ProjectDir)ui"</span> <span style="color: #006080">"$(SolutionDir)Web\ui"</span> /E /I /R /D /C /Y</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum4">   4:</span> xcopy <span style="color: #006080">"$(ProjectDir)video"</span> <span style="color: #006080">"$(SolutionDir)Web\video"</span> /E /I /R /D /C /Y</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum5">   5:</span> xcopy <span style="color: #006080">"$(ProjectDir)Xml"</span> <span style="color: #006080">"$(SolutionDir)Web\Xml"</span> /E /I /R /D /C /Y</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum6">   6:</span> xcopy <span style="color: #006080">"$(ProjectDir)Xslt"</span> <span style="color: #006080">"$(SolutionDir)Web\Xslt"</span> /E /I /R /D /C /Y </pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum7">   7:</span>&nbsp; </pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum8">   8:</span> xcopy <span style="color: #006080">"$(ProjectDir)App_Browsers\*.*"</span> <span style="color: #006080">"$(SolutionDir)Web\App_Browsers"</span> /I /R /D /Y</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum9">   9:</span> xcopy <span style="color: #006080">"$(ProjectDir)Configs\*.config"</span> <span style="color: #006080">"$(SolutionDir)Web\Configs"</span> /I /R /D /Y</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum10">  10:</span> xcopy <span style="color: #006080">"$(ProjectDir)Configs\*.config.*"</span> <span style="color: #006080">"$(SolutionDir)Web\Configs"</span> /I /R /D /Y</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum11">  11:</span> xcopy <span style="color: #006080">"$(ProjectDir)bin\*.dll"</span> <span style="color: #006080">"$(SolutionDir)Web\bin"</span> /E /I /R /D /C /Y</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum12">  12:</span> xcopy <span style="color: #006080">"$(ProjectDir)bin\*.pdb"</span> <span style="color: #006080">"$(SolutionDir)Web\bin"</span> /E /I /R /D /C /Y</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum13">  13:</span> xcopy <span style="color: #006080">"$(ProjectDir)bin\*.xml"</span> <span style="color: #006080">"$(SolutionDir)Web\bin"</span> /E /I /R /D /C /Y</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum14">  14:</span> xcopy <span style="color: #006080">"$(ProjectDir)App_GlobalResources\*.resx"</span> <span style="color: #006080">"$(SolutionDir)Web\App_GlobalResources"</span> /I /R /D /Y </pre>
<!--CRLF--></div>
</div>

<p>You’ll notice that I’ve not included any of the .Net UI files (aspx, ascx, asmx, ashx, etc)&nbsp; within the xcopy statements.&nbsp; That’s because one of the implementation differences between Web Applications and Web Sites is that WAPS refer to their codebehind file using the <strong><em>codebehind</em></strong> page directive attribute, and websites use <strong><em>codefile</em></strong>.&nbsp; Usually, when you compile (or precompile) a WS or WAP project those references get ignored as there’s no code file necessary.&nbsp; However, when you’re trying to get ASP.Net to use a WAP aspx in a website you’ll get a compilation error.&nbsp; </p>

<p>Fortunately, you don’t need a code file for the site to work – only for the ‘<strong><em>inherits</em></strong>’ attribute to be point towards your WAP page class.&nbsp; So you can use a simple script/command line utility to remove any codebehind or codefile attributes as part of the Post-Build processing.&nbsp; I’ve attached the source code for a basic command line application that I wrote to do this (imaginatively named <em>CodeBehindRemover!</em>) , the usage for the app is on line 1 of the code sample above.</p>

<p>With the post-build event in place, when you build your Web Application Project it will automatically be deployed into the vanilla workarea website.</p>

<p><strong><em>Tip: If your IIS is locking your website files and preventing deployment you can add ‘iisreset /stop’ into the Pre-Build event and ‘iisreset /restart’ at the end of the Post-Build event</em></strong></p>

<p><strong>Attachment: </strong><a title="Code Behine Remover Utility" href="http://bit.ly/d4rD4D" target="_blank"><strong>Code Behind Remover</strong></a></p>  